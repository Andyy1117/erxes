(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9939],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return m},kt:function(){return u}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),k=s(n),u=r,c=k["".concat(p,".").concat(u)]||k[u]||d[u]||i;return n?a.createElement(c,l(l({ref:t},m),{},{components:n})):a.createElement(c,l({ref:t},m))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=k;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},73673:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return o},toc:function(){return p},default:function(){return m}});var a=n(74034),r=n(79973),i=(n(67294),n(3905)),l={id:"upgrade",title:"Upgrade",sidebar_label:"Upgrade"},o={unversionedId:"installation/upgrade",id:"installation/upgrade",isDocsHomePage:!1,title:"Upgrade",description:"Following the steps in this document you can upgrade the system version.",source:"@site/docs/installation/upgrade.md",sourceDirName:"installation",slug:"/installation/upgrade",permalink:"/installation/upgrade",editUrl:"https://github.com/erxes/erxes/edit/develop/docs/docs/installation/upgrade.md",version:"current",lastUpdatedBy:"johnathon-b",lastUpdatedAt:1634030611,formattedLastUpdatedAt:"10/12/2021",sidebar_label:"Upgrade",frontMatter:{id:"upgrade",title:"Upgrade",sidebar_label:"Upgrade"},sidebar:"docs",previous:{title:"Docker",permalink:"/installation/docker"},next:{title:"Contributing guide",permalink:"/getting-started/contributing-guide"}},p=[{value:"Upgrade erxes 0.13.0 to 0.14.1",id:"upgrade-erxes-0130-to-0141",children:[]},{value:"Upgrade erxes 0.15.x to 0.18.2",id:"upgrade-erxes-015x-to-0182",children:[]},{value:"Upgrade erxes 0.17.x to 0.18.2",id:"upgrade-erxes-017x-to-0182",children:[]},{value:"Upgrade erxes 0.19.2 to latest (0.20.x)",id:"upgrade-erxes-0192-to-latest-020x",children:[]},{value:"Upgrading from v0.9+ to the latest release vx.x.x",id:"upgrading-from-v09-to-the-latest-release-vxxx",children:[{value:"Breaking Changes",id:"breaking-changes",children:[]},{value:"Env changes",id:"env-changes",children:[]}]}],s={toc:p};function m(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Following the steps in this document you can upgrade the system version."),(0,i.kt)("h2",{id:"upgrade-erxes-0130-to-0141"},"Upgrade erxes 0.13.0 to 0.14.1"),(0,i.kt)("p",null,"They can be used to upgrade erxes v0.13.0 to v 0.14.1 if you are hosting erxes on Ubuntu."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"SSH into your server as ",(0,i.kt)("inlineCode",{parentName:"p"},"erxes"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"First, stop all pm2 processes and delete pm2 apps."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"pm2 stop ecosystem.json\npm2 delete ecosystem.json\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Move erxes, erxes-api, erxes-integrations and ecosystem.json somewhere as a backup. Also backup nginx config file in /etc/nginx/sites-available/default and dump your mongodb.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Then run the installation script as ",(0,i.kt)("inlineCode",{parentName:"p"},"root")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'# If erxes hosted on Ubuntu\nbash -c "$(wget -O - https://github.com/erxes/erxes/blob/develop/scripts/install/ubuntu18.sh)"\n5. Afther the installation complete, run the following commands as `erxes` user\n\n')),(0,i.kt)("p",null,"cd ~/erxes-api\nexport MONGO_URL=mongodb://localhost/erxes?replicaSet=rs0\nyarn migrate"),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Lastly, update ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/erxes/erxes/ui/build/js/env.js"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"ecosystem.json")," and start pm2 by ",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 start ecosystem.json"),", and update nginx config using your backup and reload nginx by ",(0,i.kt)("inlineCode",{parentName:"p"},"systemctl reload nginx"),"."),(0,i.kt)("p",{parentName:"li"},"Note: We have noticed that ",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 reload ecosystem.json")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 restart ecosystem.json")," sometimes not picking up any changes to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ecosystem.json")," for some reason. So if you need to update ",(0,i.kt)("inlineCode",{parentName:"p"},"ecosystem.json")," file, please use ",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 delete ecosystem.json")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 start ecosystem.json")," in the feature."))),(0,i.kt)("h2",{id:"upgrade-erxes-015x-to-0182"},"Upgrade erxes 0.15.x to 0.18.2"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"login to your server")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"cd /home/erxes && su erxes")," ( switch to erxes user)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"pm2 delete all"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"cp erxes/ui/build/js/env.js env.js.back")," (backup env.js file)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"rm -rf erxes && rm -rf erxes-api && rm -rf erxes-integrations")," (remove old files)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Download new files"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"curl -L https://github.com/erxes/erxes/releases/download/0.18.2/erxes-0.18.2.tar.gz   | tar -xz -C .")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"curl -L https://github.com/erxes/erxes-api/releases/download/0.18.2/erxes-api-0.18.2.tar.gz   | tar -xz -C .")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"curl -L https://github.com/erxes/erxes-integrations/releases/download/0.18.2/erxes-integrations-0.18.2.tar.gz   | tar -xz -C .")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"mv env.js.back erxes/build/js/env.js")," (replace env)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"update ecosystem.json file"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"replace ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes-api/engages-email-sender")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes-engages-email-sender")),(0,i.kt)("li",{parentName:"ol"},"replace ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes-api/logger")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes-logger")),(0,i.kt)("li",{parentName:"ol"},"replace ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes/widgets")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes-widgets")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"pm2 start ecosystem.json"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"exit")," ( switch to root user )")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"vim /etc/nginx/sites-enabled/default")," (edit nginx config)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"replace ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/erxes/erxes/ui/build with "),"/home/erxes/erxes/build```")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"service nginx restart")))),(0,i.kt)("h2",{id:"upgrade-erxes-017x-to-0182"},"Upgrade erxes 0.17.x to 0.18.2"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"login to your server"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"cd /home/erxes/erxes.io && su erxes")," ( switch to erxes user)"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"pm2 delete all")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"cp erxes/js/env.js env.js.back")," (backup env.js file)"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"rm -rf erxes && rm -rf erxes-widgets && rm -rf erxes-api && rm -rf erxes-logger && rm -rf erxes-elkSyncer && rm -rf erxes-email-verifier && rm -rf erxes-engages-email-sender && rm -rf erxes-integrations")," (remove old files)"),(0,i.kt)("li",{parentName:"ol"},"Download new files",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"curl -L https://github.com/erxes/erxes/releases/download/0.18.2/erxes-0.18.2.tar.gz   | tar -xz -C .")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"curl -L https://github.com/erxes/erxes-api/releases/download/0.18.2/erxes-api-0.18.2.tar.gz   | tar -xz -C .")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"curl -L https://github.com/erxes/erxes-integrations/releases/download/0.18.2/erxes-integrations-0.18.2.tar.gz   | tar -xz -C .")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"mv env.js.back erxes/build/js/env.js")," (replace env)"),(0,i.kt)("li",{parentName:"ol"},"update ecosystem.json file",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"replace ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes.io/erxes-elkSyncer")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes.io/erxes-elkSyncer/elkSyncer")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"pm2 start ecosystem.json")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"exit")," ( switch to root user )"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"vim /etc/nginx/sites-enabled/default")," (edit nginx config)"),(0,i.kt)("li",{parentName:"ol"},"replace ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes.io/erxes")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/erxes/erxes.io/erxes/build")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"service nginx restart"))),(0,i.kt)("h2",{id:"upgrade-erxes-0192-to-latest-020x"},"Upgrade erxes 0.19.2 to latest (0.20.x)"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Login as erxes user")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"cd /home/erxes/erxes.io"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Remove old folders\n",(0,i.kt)("inlineCode",{parentName:"p"},"rm -rf erxes*"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"stop pm2 process\n",(0,i.kt)("inlineCode",{parentName:"p"},"pm2 delete all"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create erxes project\n",(0,i.kt)("inlineCode",{parentName:"p"},"yarn create erxes-app erxes"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Update MONGO_URL config"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"vim (nano) ecosystem.config.js (open ecosystem.config.js file)"),(0,i.kt)("li",{parentName:"ul"},"copy MONGO_URL config from line 14"),(0,i.kt)("li",{parentName:"ul"},"vim (nano) ../erxes.io/erxes/configs.json (open config.json file in erxes folder)"),(0,i.kt)("li",{parentName:"ul"},"replace MONGO_URL config in line 3 with the copied value")),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},"Run start command")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cd erxes")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"yarn start")),(0,i.kt)("li",{parentName:"ul"},"Enter your domain answer to the questions")),(0,i.kt)("ol",{start:8},(0,i.kt)("li",{parentName:"ol"},"Switch to su and replace nginx config")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"exit")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"cp erxes/nginx.conf /etc/nginx/sites-available/default"))),(0,i.kt)("ol",{start:9},(0,i.kt)("li",{parentName:"ol"},"Run certbot again and restart nginx")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sudo certbot --nginx")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"service nginx restart"))),(0,i.kt)("ol",{start:10},(0,i.kt)("li",{parentName:"ol"},"Done. Check your app in browser.")),(0,i.kt)("h2",{id:"upgrading-from-v09-to-the-latest-release-vxxx"},"Upgrading from v0.9+ to the latest release vx.x.x"),(0,i.kt)("h3",{id:"breaking-changes"},"Breaking Changes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Since version ",(0,i.kt)("inlineCode",{parentName:"li"},"latest vx.x.x")," Erxes started using RabbitMQ as message broker service. To update, please see example changes at docker ",(0,i.kt)("a",{parentName:"li",href:"docker"},"installation guide.")),(0,i.kt)("li",{parentName:"ul"},"Engage module is moved to ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/erxes/erxes-engages-email-sender"},"separate repository"),". Also docker ",(0,i.kt)("a",{parentName:"li",href:"docker"},"installation guide")," is updated to reflect related changes.")),(0,i.kt)("h3",{id:"env-changes"},"Env changes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"erxes"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"REACT_APP_INTEGRATIONS_API_URL")," - is no longer used"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"erxes-api"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ENGAGES_API_DOMAIN")," - erxes-engages service endpoint"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RABBITMQ_HOST")," - RabbitMQ connection uri"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"erxes-widgets-api"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RABBITMQ_HOST")," - RabbitMQ connection uri"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"erxes-integrations"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RABBITMQ_HOST")," - RabbitMQ connection uri"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"erxes-engages"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"PORT")," - engages service running port"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"NODE_ENV")," - node environment"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"DEBUG")," - enable logging"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MAIN_API_DOMAIN")," - erxes api url"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"MONGO_URL")," - MongoDB connection uri"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RABBITMQ_HOST")," - RabbitMQ connection uri")))))}m.isMDXComponent=!0}}]);